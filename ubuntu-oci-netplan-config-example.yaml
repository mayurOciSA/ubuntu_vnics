
# Netplan Configuration for Ubuntu compute instances on OCI, auto-generated by ubuntu_netplan_oci.py
# This configuration can handle multi-homed setups with multiple VNICs.
# Instance OCID: ocid1.instance.oc1.phx.anyhqljtk6odqwqcov
# This file configures all VNICs/network-interfaces. All 2ndary are setup with policy-based routing
# Each VNIC is configured with static IPs, DNS, gateways and routing policies used typically for a multihome setup
# The configuration uses MAC address matching for each interface
# For each VNIC the first IP listed for it below, is its primary IPv4 address

network:
  version: 2
  renderer: networkd
  ethernets:
    etho:
      # Primary VNIC: ocid1.vnic.oc1.phx.abyhqljtwwam6h33d2 
      # Connected to Subnet name: pub2 
      # Subnet OCID: ocid1.subnet.oc1.phx.aaaaaaaazs4
      # First IP of this primary interface, listed below, is treated as primary/default by convention(when none is spcified by the application) 
      # All routes for primary VNIC will be in main route table of linux 
      # All routes for primary VNIC have lower metric than that of all 2ndary VNICs, making them preferred and default 
      # 
      match:
        macaddress: 02:00:17:30:14:4E
      dhcp4: false
      dhcp6: false
      accept-ra: false
      addresses:
        - 10.0.2.186/24
        - fd00:1234:5678:cc:de43:8b7d:dfe6:f29e/128
        - fdaa:1234:5678:dd:96fb:3a3d:35e0:1001/128
        - 2603:c020:17:3cff:f50b:1a69:296c:9a54/128
      mtu: 9000
      set-name: eth0
      nameservers:
        addresses:
          - 8.8.8.8
          - 169.254.169.254
          - fd00:00c1::a9fe:a9fe
      optional: false
      routes:
        # IPv4 default route for traffic from this VNIC, via its subnet's IPv4 gateway
        - to: 0.0.0.0/0
          via: 10.0.2.1
          metric: 10
        - to: 169.254.0.0/16
          scope: link
          metric: 10
        # IPv6 default route for this VNIC, via its subnet's IPv6 gateway
        - to: ::/0
          via: fe80::200:17ff:febc:9eda
          metric: 10
    eth1:
      # Secondary VNIC: ocid1.vnic.oc1.phx.abyhqljtps7nm7bnsajv3d2ehiw6nylcf
      # Connected to subnet name: sub0vcn1
      # Subnet OCID: ocid1.subnet.oc1.phx.aaaaaaaauuysqzt4hkmrwzscv
      # Using policy-based routing with table 101
      # 
      match:
        macaddress: 02:00:17:0F:D4:E3
      dhcp4: false
      dhcp6: false
      accept-ra: false
      addresses:
        - 11.0.0.202/24
        - 11.0.0.112/24
        - 2603:c020:14:7aa:207b:e4a5:d9f8:f29/128
        - fd8a:23c5:b7e1:dd:b620:4c4b:e8a6:68ad/128
        - 2603:c020:14:7aa:63eb:eb1b:de8c:4dc9/128
      mtu: 9000
      set-name: eth1
      nameservers:
        addresses:
          - 169.254.169.254
          - fd00:00c1::a9fe:a9fe
      optional: true
      routing-policy:
        - from: 11.0.0.202
          table: 101
        - from: 11.0.0.112
          table: 101
        - from: 2603:c020:14:7aa:207b:e4a5:d9f8:f29
          table: 101
        - from: fd8a:23c5:b7e1:dd:b620:4c4b:e8a6:68ad
          table: 101
        - from: 2603:c020:14:7aa:63eb:eb1b:de8c:4dc9
          table: 101
      routes:
        # IPv4 default route for traffic from this VNIC, via its subnet's IPv4 gateway
        - to: 0.0.0.0/0
          via: 11.0.0.1
          table: 101
          metric: 100
        - to: 169.254.0.0/16
          scope: link
          table: 101
          metric: 100
        # IPv6 default route for this VNIC, via its subnet's IPv6 gateway
        - to: ::/0
          via: fe80::200:17ff:fed7:1708
          table: 101
          metric: 100
    eth2:
      # Secondary VNIC: ocid1.vnic.oc1.phx.abyhqljtbjazza
      # Connected to subnet name: sub0vcn2
      # Subnet OCID: ocid1.subnet.oc1.phx.aaaaaaaaw3rfmth
      # Using policy-based routing with table 102
      # 
      match:
        macaddress: 02:00:17:0E:33:A9
      dhcp4: false
      dhcp6: false
      accept-ra: false
      addresses:
        - 12.0.0.10/24
        - 2603:c020:b:49aa:676b:7832:dd2a:a157/128
      mtu: 9000
      set-name: eth2
      nameservers:
        addresses:
          - 169.254.169.254
          - fd00:00c1::a9fe:a9fe
        search:
          - vcn2.oraclevcn.com
      optional: true
      routing-policy:
        - from: 12.0.0.10
          table: 102
        - from: 2603:c020:b:49aa:676b:7832:dd2a:a157
          table: 102
      routes:
        # IPv4 default route for traffic from this VNIC, via its subnet's IPv4 gateway
        - to: 0.0.0.0/0
          via: 12.0.0.1
          table: 102
          metric: 100
        - to: 169.254.0.0/16
          scope: link
          table: 102
          metric: 100
        # IPv6 default route for this VNIC, via its subnet's IPv6 gateway
        - to: ::/0
          via: fe80::200:17ff:fe7f:6bee
          table: 102
          metric: 100
    lo:
      # Loopback interface configuration
      dhcp4: false
      dhcp6: false
      addresses:
        - 127.0.0.1/8
        - ::1/128